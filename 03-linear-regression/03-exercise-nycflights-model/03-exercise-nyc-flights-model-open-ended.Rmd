---
title: "NYCFlights: Arrival Delay Regression Model (Open Ended Variation)"
author: "[Your Name]"
date: "[Today's Date]"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library("tidyverse")
library("ggplot2")
library("lubridate")
library("dplyr")
library("data.table")
```

# NYCFlights Model

Using the rectangular data that you created last week create a model for `arr_delay`. Follow a well defined process for creating a model as discussed in class or from one of the readings. 

Break the process down into steps and create a codeblock for each step. 
 - Use as many steps you feel as necessary
 - Concisely explain each step 
 - Show all work
 
(You can start with the data that you created last week.)


## Step 1: [Step Name] 

```{r "Step 1: [Step Name]" }




flights <- read.csv("~/ml_at_berkeley/CSX460/02-building-blocks/02-exercise-nycflights/data/flights.csv",  stringsAsFactors = FALSE)
planes <- read.csv("~/ml_at_berkeley/CSX460/02-building-blocks/02-exercise-nycflights/data/planes.csv",  stringsAsFactors = FALSE)
airports <- read.csv("~/ml_at_berkeley/CSX460/02-building-blocks/02-exercise-nycflights/data/airports.csv",  stringsAsFactors = FALSE)
weather <- read.csv("~/ml_at_berkeley/CSX460/02-building-blocks/02-exercise-nycflights/data/weather.csv",  stringsAsFactors = FALSE)


planes <- setnames(planes, old = c('year'), new = c('manufacture_year'))

flights <- flights %>% select(., -time_hour) 
weather <- weather %>% select(., -time_hour) 



head(flights)
form.dep_hour <- round(flights$sched_dep_time /100)
flights$dep_hour <- form.dep_hour

head(flights)
```
```{r}



form.dep_hour <- round(flights$sched_dep_time /100)
flights$dep_hour <- form.dep_hour

dim (flights)

data.joined <- flights %>% left_join(planes, by = c('tailnum' = 'tailnum')) %>%  left_join(airports, c("dest"="faa"))  %>% left_join(weather, by = c('year'='year', 'month'='month', 'day'='day', 'dep_hour'='hour', 'origin'='origin')) 

dim(data.joined)

str(data.joined)

#lapply(data.joined, levels)


# %>%  left_join(airports, c("origin"="faa")) 


```


```{r}
data.joined.sample <- sample_frac(data.joined, 1)

fit <- lm(dep_delay ~ year + month +day + dep_time + sched_dep_time + arr_time + sched_arr_time + arr_delay + carrier + flight + tailnum + origin + dest + air_time + distance + hour + minute + dep_hour + manufacture_year + type + manufacturer + model + engines + seats + speed + engine + name + lat + lon + alt + tz + temp + dewp + humid + wind_dir + wind_speed + wind_gust + precip + pressure + visib ,  data=data.joined.sample)
summary(fit)

```


## Step 2:

Remove Features (Independant Variables) with high p-value



```{r}


fit <- lm(dep_delay ~ year + month +day + sched_dep_time + sched_arr_time + carrier + flight + tailnum + origin + dest +  distance + hour + minute + manufacture_year + type + manufacturer + model + engines + seats + speed + engine + name + lat + lon + alt + tz + temp + dewp + humid + wind_dir + wind_speed + wind_gust + precip + pressure + visib,  data=data.joined.sample)


summary(fit)
hist(resid(fit))



```






# Question:


```{r}
hist(resid(fit))
```


Is this a good model?  (Write your answer here.)

