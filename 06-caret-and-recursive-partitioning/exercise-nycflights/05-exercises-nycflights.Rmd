---
title: "Caret / Recursive Partitioning"
author: "Your Name Here"
date: "Today's Date"
output:
  html_document: default
  pdf_document: default
---

```{r init, warning=FALSE, echo=FALSE, message=FALSE}
library(rpart)
library(caret)
library(data.table)
library(magrittr)
library(dplyr)


# .. Additional libraries
```


Load the data

```{r}
flightsDT  <- fread("~/ml_at_berkeley/CSX460/02-building-blocks/02-exercise-nycflights/data/flights.csv") 





```


Merge data

```{r}


```


## Add a categorical variable for  arr_delay >= 22 minutes. It is called arrival_delayed  

```{r}

```



Filter out rows with NAs

```{r}


```


## Exercise 1: caret/logistic regression (5 points)

Rebuild your logistic regression model from the previous week, this time using the `caret` package. 

- Calculate the training or apparent performance of the model. 
- Calculate an unbiased measure of performance 
- Create a ROC Curve for your model

Show all work.

```{r logistic model}
# Your Work Here


#data.joined <- readRDS(file="/home/saqib/ml_at_berkeley/CSX460/04-logistic-regression/04-exercise-nycflights-logistic/flightdata.Rda")
flightsDT$arrival_delayed <- factor(ifelse(flightsDT$arr_delay >= 22, 1,0))
#flightsDT <- sample_frac(flightsDT, .1)
flightsDT <- flightsDT[, speed:=NULL]


#data.joined <- sample_frac(data.joined, .1)
#data.joined <-as.data.table(data.joined)

#data.joined <- data.joined[, speed:=NULL]

#data.joined <- na.omit(data.joined)


str(flightsDT)

#str(data.joined)
#lapply(data.joined, levels)


(l <- sapply(flightsDT, function(x) is.factor(x)))

fitControl <- trainControl(method = "repeatedcv",
                           number = 2,
                           repeats = 2
                           ## Estimate class probabilities
                      #     classProbs = TRUE,
                           ## Evaluate performance using 
                           ## the following function
                      #     summaryFunction = twoClassSummary
                      )



glmBoostModel <- train(arrival_delayed ~ ., 
                       data=flightsDT, 
                       method = "glm", 
                   #    metric="ROC", 
                       trControl = fitControl, 
                       tuneLength=5,
                       na.action = na.omit,
                       center=TRUE, 
                       family=binomial()
               )


```


## Exercise 2: caret/rpart (5 points)

Using the `caret` and `rpart` packages, create a **classification** model for flight delays using your NYC FLight data. Your solution should include:

- The use of `caret` and `rpart` to train a model.
- An articulation of the the problem your are 
- An naive model
- An unbiased calculation of the performance metric
- A plot of your model -- (the actual tree; there are several ways to do this)
- A discussion of your model 



Show and describe all work

```{r rpart model}
# Your Work Here
```


### Questions:

- Discuss the difference between the models and why you would use one model over the other?
- How might you produce an ROC type curve for the *rpart* model? 
